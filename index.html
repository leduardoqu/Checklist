<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIAGNÓSTICO LOGÍSTICA</title>
    
    <!-- Estilo Simples para não depender de download -->
    <style>
        body { font-family: sans-serif; background: #eee; padding: 20px; }
        .box { background: white; padding: 20px; border-radius: 10px; max-width: 400px; margin: 0 auto; border-top: 5px solid red; }
        input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; }
        button { width: 100%; padding: 15px; background: red; color: white; font-weight: bold; border: none; cursor: pointer; }
        #debug-console { 
            background: black; color: lime; font-family: monospace; 
            padding: 10px; margin-top: 20px; min-height: 150px; 
            white-space: pre-wrap; font-size: 12px;
        }
    </style>

    <!-- SISTEMA DE LOG VISUAL (Carrega antes de tudo) -->
    <script>
        function log(msg) {
            const el = document.getElementById('debug-console');
            if(el) el.innerHTML += "> " + msg + "\n";
            console.log(msg);
        }
        window.onerror = function(msg, url, line) {
            log("ERRO GLOBAL: " + msg + " (Linha: " + line + ")");
            return false;
        };
    </script>

    <!-- FIREBASE (CDN PADRÃO) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" onload="log('Lib App carregada')" onerror="log('ERRO: Falha ao baixar Firebase App')"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" onload="log('Lib Auth carregada')" onerror="log('ERRO: Falha ao baixar Firebase Auth')"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" onload="log('Lib Firestore carregada')" onerror="log('ERRO: Falha ao baixar Firebase Firestore')"></script>

</head>
<body>

    <div class="box">
        <h2 style="text-align: center;">Teste de Conexão</h2>
        
        <input type="email" id="email" placeholder="Email">
        <input type="password" id="password" placeholder="Senha">
        
        <button id="btnEntrar" onclick="cliqueBotao()">ENTRAR</button>
    </div>

    <!-- CAIXA PRETA DA VERDADE -->
    <div id="debug-console">INICIANDO DIAGNÓSTICO...
</div>

    <script>
        // CONFIGURAÇÃO (SUA CONFIG ORIGINAL)
        const firebaseConfig = {
            apiKey: "AIzaSyCgWfdAVTVFhKRS-BLWGJrIt68hdq-OMhg",
            authDomain: "logisticacloud-1cc32.firebaseapp.com",
            projectId: "logisticacloud-1cc32",
            storageBucket: "logisticacloud-1cc32.firebasestorage.app",
            messagingSenderId: "883823898286",
            appId: "1:883823898286:web:6c22160dad0cd403a0873f"
        };

        let auth, db;

        // TENTA INICIAR AUTOMATICAMENTE
        window.onload = function() {
            log("Janela carregada completely.");
            
            // 1. Verifica se o Firebase existe
            if (typeof firebase === 'undefined') {
                log("ERRO FATAL: A variável 'firebase' não existe.");
                log("CAUSA: O download dos scripts foi bloqueado pela sua rede.");
                document.getElementById('btnEntrar').style.background = 'gray';
                document.getElementById('btnEntrar').innerText = "BLOQUEADO";
                return;
            }

            // 2. Tenta conectar
            try {
                log("Tentando inicializar Firebase...");
                firebase.initializeApp(firebaseConfig);
                auth = firebase.auth();
                db = firebase.firestore();
                log("SUCESSO: Firebase conectado e pronto.");
            } catch (e) {
                log("ERRO CONFIG: " + e.message);
            }
        };

        // FUNÇÃO DO CLIQUE
        function cliqueBotao() {
            log("----------------");
            log("BOTÃO CLICADO.");
            
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;

            if (!auth) {
                log("ERRO: O sistema de autenticação não está pronto.");
                return;
            }

            log("Enviando dados para o Google...");
            
            auth.signInWithEmailAndPassword(email, pass)
                .then((userCred) => {
                    log("LOGIN SUCESSO! Usuário: " + userCred.user.email);
                    alert("LOGIN FUNCIONOU! O problema está resolvido.");
                })
                .catch((error) => {
                    log("FALHA NO LOGIN:");
                    log("Código: " + error.code);
                    log("Mensagem: " + error.message);
                    
                    if (error.code === 'auth/network-request-failed') {
                        alert("ERRO DE REDE: O firewall da empresa bloqueou a conexão.");
                    } else if (error.code === 'auth/operation-not-allowed') {
                        log("DICA: Ative o Login por Email/Senha no painel do Firebase.");
                    } else if (error.code === 'auth/invalid-credential') {
                        log("Tentando criar conta...");
                        criarConta(email, pass);
                    }
                });
        }

        function criarConta(email, pass) {
            auth.createUserWithEmailAndPassword(email, pass)
                .then(() => {
                    log("CONTA CRIADA COM SUCESSO!");
                    alert("Conta criada e logada!");
                })
                .catch((e) => {
                    log("Erro ao criar conta: " + e.code);
                });
        }

    </script>
</body>
</html>